<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />

    <title>My first BootstrapVue app</title>

    <!-- Required Stylesheets -->
    <link type="text/css" rel="stylesheet" href="https://unpkg.com/bootstrap/dist/css/bootstrap.min.css" />
    <link type="text/css" rel="stylesheet" href="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.css" />

    <!-- Required scripts -->
    <script src="https://unpkg.com/vue"></script>
    <script src="https://unpkg.com/babel-polyfill@latest/dist/polyfill.min.js"></script>
    <script src="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.js"></script>
    <script src="https://kit.fontawesome.com/1f9e195355.js"></script>
</head>

<body class="bg-light">
    <!-- Our application root element -->
    <div id="app">
        <b-container>
            <div class="row py-5">
                <!-- team 1 -->
                <div class="col">
                    <div v-if="teams[0] !== undefined">
                        <h1>{{ teams[0].name }}</h1>
                        <div class="row">
                            <player v-model="team1Position5"></player>
                            <player v-model="team1Position4"></player>
                        </div>
                        <div class="row">
                            <player v-model="team1Position6"></player>
                            <player v-model="team1Position3"></player>
                        </div>
                        <div class="row">
                            <player v-model="team1Position1"></player>
                            <player v-model="team1Position2"></player>
                        </div>
                        <div class="row mt-4">
                            <div class="col d-flex justify-content-center">
                                <b-button class="btn-lg" variant="primary" @click="rotate(0)">
                                    <i class="fas fa-sync-alt"></i>
                                </b-button>
                            </div>
                        </div>
                    </div>
                    <div v-else class="d-flex justify-content-center align-items-center">
                        <b-button class="btn-lg" variant="primary" @click="setupTeam('0')">Add team</b-button>
                    </div>
                </div>

                <!-- net -->
                <div class="col-1 d-flex justify-content-center">
                    <div class="bg-secondary" style="height: 100%; width: 3px;"></div>
                </div>

                <!-- team 2 -->
                <div class="col">
                    <div v-if="teams[1] !== undefined">
                        <h1>{{ teams[1].name }}</h1>
                        <div class="row">
                            <player v-model="team2Position2"></player>
                            <player v-model="team2Position1"></player>
                        </div>
                        <div class="row">
                            <player v-model="team2Position3"></player>
                            <player v-model="team2Position6"></player>
                        </div>
                        <div class="row">
                            <player v-model="team2Position4"></player>
                            <player v-model="team2Position5"></player>
                        </div>
                        <div class="row mt-4">
                            <div class="col d-flex justify-content-center">
                                <b-button class="btn-lg" variant="primary" @click="rotate(1)">
                                    <i class="fas fa-sync-alt"></i>
                                </b-button>
                            </div>
                        </div>
                    </div>
                    <div v-else class="d-flex justify-content-center align-items-center">
                        <b-button class="btn-lg" variant="primary" @click="setupTeam('1')">Add team</b-button>
                    </div>
                </div>
            </div>
        </b-container>

        <b-modal ref="team-setup" hide-footer title="Team setup">
            <b-form autocomplete="off" @submit.prevent="submitTeam()">
                <div class="row">
                    <div class="col">
                        <b-form-input v-model="teamEntry.name" type="text" required placeholder="Team name">
                        </b-form-input>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col">
                        <label>Players (in rotation)</label>
                        <div v-for="i in 6" class="pb-1">
                            <b-form-input v-model="teamEntry.players[i - 1]" type="number" required
                                :placeholder="i.toString()">
                            </b-form-input>
                        </div>
                    </div>
                    <div class="col">
                        <label>Subs (no particular order)</label>
                        <div v-for="i in 6" class="pb-1">
                            <b-form-input v-model="teamEntry.subs[i - 1]" type="number">
                            </b-form-input>
                        </div>
                    </div>
                </div>
                <b-button class="mt-2 btn-lg btn-block" type="submit" variant="primary">Confirm</b-button>
            </b-form>
        </b-modal>
    </div>


    <!-- Start running your app -->
    <script>
        Vue.component('Player', {
            props: ['value'],
            template:
                `<div class="col d-flex justify-content-center mt-1 mb-1">
                    <div class="rounded-circle border border-primary d-flex justify-content-center align-items-center" style="background-color: white; width: 75px; height: 75px;">
                        <b>{{ value.playerNumber }}</b>
                    </div>
                </div>`
        });

        window.app = new Vue({
            el: '#app',
            computed: {
                team1Position1() {
                    return this.teams[0].players.find(p => p.position === 1);
                },
                team1Position2() {
                    return this.teams[0].players.find(p => p.position === 2);
                },
                team1Position3() {
                    return this.teams[0].players.find(p => p.position === 3);
                },
                team1Position4() {
                    return this.teams[0].players.find(p => p.position === 4);
                },
                team1Position5() {
                    return this.teams[0].players.find(p => p.position === 5);
                },
                team1Position6() {
                    return this.teams[0].players.find(p => p.position === 6);
                },
                team2Position1() {
                    return this.teams[1].players.find(p => p.position === 1);
                },
                team2Position2() {
                    return this.teams[1].players.find(p => p.position === 2);
                },
                team2Position3() {
                    return this.teams[1].players.find(p => p.position === 3);
                },
                team2Position4() {
                    return this.teams[1].players.find(p => p.position === 4);
                },
                team2Position5() {
                    return this.teams[1].players.find(p => p.position === 5);
                },
                team2Position6() {
                    return this.teams[1].players.find(p => p.position === 6);
                },
            },
            data: {
                name: '',
                teams: [],
                teamEntry: {
                    number: null,
                    name: '',
                    players: [],
                    subs: [],
                }
            },
            methods: {
                setupTeam(teamNumber) {
                    this.teamEntry.teamNumber = teamNumber;
                    this.$refs['team-setup'].show();
                },
                submitTeam() {
                    let players = [];
                    for (var i = 0; i < this.teamEntry.players.length; i++) {
                      players.push({
                          playerNumber: this.teamEntry.players[i],
                          startingPosition: i + 1,
                          position: i + 1,
                      });
                    }

                    this.teams[this.teamEntry.teamNumber] = {
                        name: this.teamEntry.name,
                        players: players,
                        subs: this.teamEntry.subs,
                    };

                    this.copyTeams();

                    // clear team entry
                    this.teamEntry = {
                        teamNumber: null,
                        name: '',
                        players: [],
                        subs: [],
                    };

                    this.$refs['team-setup'].hide();
                },
                rotate(teamNumber) {
                    let teamToRotate = this.teams[teamNumber];

                    for (var i = 0; i < teamToRotate.players.length; i++) {
                        let player = teamToRotate.players[i];
                        if (player.position === 1) {
                            player.position = 6;
                        } else {
                            player.position--;
                        }
                    }

                    this.teams[teamNumber] = teamToRotate;

                    this.copyTeams();                    
                },
                copyTeams() {
                    let teamsCopy = [];

                    for (var i = 0; i < this.teams.length; i++) {
                        teamsCopy.push(this.teams[i]);
                    }

                    this.teams = teamsCopy;
                }
            },
        });
    </script>
</body>

</html>
